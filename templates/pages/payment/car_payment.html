{% extends 'layouts/app.html' %}

{% block content %}
<section class="layout-radius pt-5 pb-5">
    <div class="boxcar-container text-center">
        <h2 class="mb-4">Complete Your Payment</h2>
        <p class="lead mb-4">Booking: {{ payment.booking.car.name }}</p>
        <p class="mb-3">Total: <strong>${{ payment.booking.total_price }}</strong></p>

        <button onclick="startPayment()" class="side-btn">
            Proceed to Pay
        </button>
    </div>
</section>

<script src="https://dashboard.sandbox.irembopay.com/assets/payment/inline.js"></script>
<script>
    function startPayment() {
        const publicKey = "{{ public_key }}";
        const invoiceNumber = "{{ payment.invoice_number }}";

        console.log("üöó Starting IremboPay for Car Booking...");
        console.log("Invoice Number:", invoiceNumber);

        IremboPay.initiate({
            publicKey: publicKey,
            invoiceNumber: invoiceNumber,
            locale: IremboPay.locale.EN,
            callback: function (err, resp) {
                if (!err && resp?.payment_status === 'success') {
                    alert("‚úÖ Payment successful!");
                    window.location.href = "{% url 'car:carDetails' payment.booking.car.id %}";
                } else {
                    alert("‚ùå Payment failed or cancelled.");
                    console.log(err, resp);
                }
            }
        });
    }
</script>
{% endblock %}
